# 数据库的事务隔离级别有哪些？各有哪些优缺点？

## 事务及其特性

数据库事务是数据库管理系统执行过程中的一个逻辑单位，由一个有限的数据库操作序列组成。事务的使用是数据库管理系统区分文件系统的重要特征之一。

事务拥有四个重要的特性：原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持久性（Durabnility），人们习惯称职位ACID特性。

### 原子性（Atomicity）

事务开始后所有操作，要么全部做完，要么全部不做，不可能停滞在中间环节。事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。

### 一致性（Consistency）

指事务将数据库从一种状态转变为另一种一致的的状态。事务开始前和结束后，数据库的完整性约束没有被破坏。

### 隔离性（Isolation）

要求每个读写事务的对象对其他事务的操作对象能互相分离，即该事务提交前对其他事务不可见。 也可以理解为多个事务并发访问时，事务之间是隔离的，一个事务不应该影响其它事务运行效果。这指的是在并发环境中，当不同的事务同时操纵相同的数据时，每个事务都有各自的完整数据空间。由并发事务所做的修改必须与任何其他并发事务所做的修改隔离。

注：MySQL 通过锁机制来保证事务的隔离性。

### 持久性（Durability）

事务一旦提交，则其结果就是永久性的。即使发生宕机的故障，数据库也能将数据恢复，也就是说事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。这只是从事务本身的角度来保证，排除 RDBMS（关系型数据库管理系统，例如 Oracle、MySQL 等）本身发生的故障。

注：MySQL 使用 `redo log` 来保证事务的持久性。

## 四种隔离级别

### 读未提交

该隔离级别的事务会督导其他未提交事务的数据，此现象称之为**脏读**。

### 读提交

一个事务可以读取另一个已提交的事务，多次读取会造成不一样的结果，此现象称为**不可重复读**问题，Oracle 和 SQL Server 的默认隔离级别。

### 可重复读

该隔离级别是 MySQL 默认的隔离级别，在同一个事务里， `select` 的结果是事务开始时时间点的状态，因此，同样的 `select` 操作读到的结果会是一致的，但是，会有 **幻读** 现象。MySQL 的 InnoDB 引擎可以通过 `next-key locks` 机制来避免幻读。

### 序列化

在该隔离级别下事务都是串行顺序执行的，MySQL 数据库的 InnoDB 引擎会给读操作隐式加一把读共享锁，从而避免了**脏读**、**不可重读复读**和**幻读**问题。

## 各个隔离级别下产生的一些问题

| **隔离级别** | **脏读**   | **不可重复读** | **幻读**   |
| :----------- | :--------- | :------------- | :--------- |
| 读未提交     | 可以出现   | 可以出现       | 可以出现   |
| 读提交       | 不允许出现 | 可以出现       | 可以出现   |
| 可重复读     | 不允许出现 | 不允许出现     | 可以出现   |
| 序列化       | 不允许出现 | 不允许出现     | 不允许出现 |